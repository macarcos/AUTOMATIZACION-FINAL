<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Riego Automatizado v2.0</title>
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Estilos CSS -->
    <link rel="stylesheet" href="css/style-global.css">
    <link rel="stylesheet" href="css/style-monitoring.css">
    <link rel="stylesheet" href="css/style-charts.css">
    <link rel="stylesheet" href="css/style-arduino.css">
</head>
<body>
    <!-- Header Global -->
    <div class="header-global">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">ğŸŒ±</div>
                <div class="logo-text">
                    <h1>Sistema de Riego Automatizado</h1>
                    <p>Multi-Arduino v2.0</p>
                </div>
            </div>
            <div class="connection-indicators">
                <div class="indicator" id="sensor-indicator">
                    <span class="indicator-dot">âšª</span>
                    <span>Sensores</span>
                </div>
                <div class="indicator" id="pump-indicator">
                    <span class="indicator-dot">âšª</span>
                    <span>Bomba</span>
                </div>
            </div>
        </div>
    </div>

    <!-- NavegaciÃ³n -->
    <nav class="main-nav">
        <a href="#" class="nav-item active" onclick="showPage('monitoring'); return false;">
            <span class="nav-icon">ğŸ“Š</span>
            <span>Monitoreo y Control</span>
        </a>
        <a href="#" class="nav-item" onclick="showPage('charts'); return false;">
            <span class="nav-icon">ğŸ“ˆ</span>
            <span>GrÃ¡ficas y Datos</span>
        </a>
        <a href="#" class="nav-item" onclick="showPage('arduino'); return false;">
            <span class="nav-icon">ğŸ”Œ</span>
            <span>ConexiÃ³n Arduino</span>
        </a>
    </nav>

    <!-- ========================================= -->
    <!-- PÃGINA 1: MONITOREO Y CONTROL -->
    <!-- ========================================= -->
    <div id="page-monitoring" class="page-content active">
        <div class="container">
            
            <!-- Estado Actual de Sensores -->
            <div class="section">
                <h3>ğŸ“Š Estado de Sensores en Tiempo Real</h3>
                <div class="status-grid">
                    <div class="status-card normal" id="gasCard">
                        <div class="status-header">
                            <span class="status-title">ğŸ”¥ Sensor de Gas</span>
                            <span class="status-icon">âœ…</span>
                        </div>
                        <div class="status-value" id="gasValue">0</div>
                        <div class="status-description" id="gasStatus">ğŸŸ¢ Normal - Sin detecciÃ³n</div>
                    </div>

                    <div class="status-card normal" id="ultrasonicCard">
                        <div class="status-header">
                            <span class="status-title">ğŸ“ Nivel de Tanque</span>
                            <span class="status-icon">ğŸ“Š</span>
                        </div>
                        <div class="status-value" id="ultrasonicValue">0 cm</div>
                        <div class="status-description" id="ultrasonicStatus">âŒ Sin datos del sensor</div>
                    </div>

                    <div class="status-card normal" id="soilCard">
                        <div class="status-header">
                            <span class="status-title">ğŸŒ± Humedad del Suelo</span>
                            <span class="status-icon">ğŸ’§</span>
                        </div>
                        <div class="status-value" id="soilValue">0%</div>
                        <div class="status-description" id="soilStatus">Sin datos del sensor</div>
                    </div>

                    <div class="status-card normal" id="tempCard">
                        <div class="status-header">
                            <span class="status-title">ğŸŒ¡ï¸ Temperatura</span>
                            <span class="status-icon">ğŸŒ¡ï¸</span>
                        </div>
                        <div class="status-value" id="tempValue">0Â°C</div>
                        <div class="status-description" id="tempStatus">Sin datos</div>
                    </div>

                    <div class="status-card normal" id="humidCard">
                        <div class="status-header">
                            <span class="status-title">ğŸ’¨ Humedad del Aire</span>
                            <span class="status-icon">ğŸŒ«ï¸</span>
                        </div>
                        <div class="status-value" id="humidValue">0%</div>
                        <div class="status-description" id="humidStatus">Sin datos</div>
                    </div>
                </div>
            </div>

            <!-- ConfiguraciÃ³n de ParÃ¡metros -->
            <div class="section">
                <h3>âš™ï¸ ConfiguraciÃ³n de ParÃ¡metros del Sistema</h3>
                <div class="config-grid">
                    <!-- ConfiguraciÃ³n de Gas -->
                    <div class="config-card">
                        <div class="config-title">ğŸ”¥ ParÃ¡metros de Gas</div>
                        <div class="param-input-group">
                            <label>Nivel Bueno (mÃ¡ximo):</label>
                            <input type="number" id="gasGoodMax" value="30" min="0" max="1000">
                        </div>
                        <div class="param-input-group">
                            <label>Nivel Regular (mÃ¡ximo):</label>
                            <input type="number" id="gasRegularMax" value="100" min="0" max="1000">
                        </div>
                        <div class="param-input-group">
                            <label>Nivel Malo (mÃ¡ximo):</label>
                            <input type="number" id="gasBadMax" value="150" min="0" max="1000">
                        </div>
                        <button class="btn" onclick="updateGasParameters()">Actualizar Gas</button>
                        
                        <div class="param-display" id="gasParametersDisplay">
                            <strong>ParÃ¡metros de Gas:</strong><br>
                            ğŸŸ¢ Bueno: 0 - 30<br>
                            ğŸŸ¡ Regular: 31 - 100<br>
                            ğŸŸ  Malo: 101 - 150<br>
                            ğŸ”´ Peligroso: 151+
                        </div>
                    </div>

                    <!-- ConfiguraciÃ³n de Ultrasonido -->
                    <div class="config-card">
                        <div class="config-title">ğŸ“ ParÃ¡metros de Ultrasonido</div>
                        <div class="param-input-group">
                            <label>Nivel MÃ­nimo (mÃ¡ximo cm):</label>
                            <input type="number" id="ultraMinMax" value="5" min="0" max="100">
                        </div>
                        <div class="param-input-group">
                            <label>Nivel Regular (mÃ¡ximo cm):</label>
                            <input type="number" id="ultraRegularMax" value="15" min="0" max="100">
                        </div>
                        <div class="param-input-group">
                            <label>Nivel MÃ¡ximo (mÃ¡ximo cm):</label>
                            <input type="number" id="ultraMaxMax" value="25" min="0" max="100">
                        </div>
                        <button class="btn" onclick="updateUltrasonicParameters()">Actualizar Ultrasonido</button>
                        
                        <div class="param-display" id="ultraParametersDisplay">
                            <strong>ParÃ¡metros de Ultrasonido:</strong><br>
                            ğŸ”´ Desborde (VacÃ­o): 0 - 5 cm<br>
                            ğŸŸ¡ Regular: 6 - 15 cm<br>
                            ğŸŸ¢ MÃ¡ximo (Lleno): 16 - 25 cm<br>
                            âš ï¸ VACIO: 26+ cm
                        </div>
                    </div>
                </div>
            </div>

            <!-- ConfiguraciÃ³n de Plantas de Ecuador -->
            <div class="section">
                <h3>ğŸ‡ªğŸ‡¨ ConfiguraciÃ³n de Plantas del Ecuador</h3>
                <div class="controls-grid">
                    <div class="control-group">
                        <h4>Seleccionar Planta por RegiÃ³n</h4>
                        <div class="input-group">
                            <label>Planta:</label>
                            <select id="plantSelect">
                                <option value="">Seleccionar planta...</option>
                                <optgroup label="ğŸ‡ Frutas Tropicales">
                                    <option value="mango">ğŸ¥­ Mango</option>
                                    <option value="banano">ğŸŒ Banano</option>
                                    <option value="cacao">ğŸ« Cacao</option>
                                    <option value="platano">ğŸŒ PlÃ¡tano</option>
                                    <option value="maracuya">ğŸ¥¤ MaracuyÃ¡</option>
                                </optgroup>
                                <optgroup label="ğŸŠ CÃ­tricos">
                                    <option value="naranja">ğŸŠ Naranja</option>
                                    <option value="limon">ğŸ‹ LimÃ³n</option>
                                </optgroup>
                                <optgroup label="ğŸ”ï¸ Frutas de la Sierra">
                                    <option value="fresa">ğŸ“ Fresa</option>
                                    <option value="mora">ğŸ« Mora</option>
                                </optgroup>
                                <optgroup label="ğŸ¥— Hortalizas">
                                    <option value="tomate">ğŸ… Tomate</option>
                                    <option value="lechuga">ğŸ¥¬ Lechuga</option>
                                </optgroup>
                                <optgroup label="ğŸ¥” TubÃ©rculos">
                                    <option value="papa">ğŸ¥” Papa</option>
                                </optgroup>
                                <optgroup label="ğŸŒ¿ AromÃ¡ticas">
                                    <option value="albahaca">ğŸŒ¿ Albahaca</option>
                                    <option value="oregano">ğŸŒ¿ OrÃ©gano</option>
                                </optgroup>
                                <optgroup label="ğŸ’Š Medicinales">
                                    <option value="hierba_buena">ğŸŒ± Hierba Buena</option>
                                </optgroup>
                                <optgroup label="ğŸŒ¹ Ornamentales">
                                    <option value="rosa">ğŸŒ¹ Rosa</option>
                                </optgroup>
                                <optgroup label="ğŸŒµ CactÃ¡ceas">
                                    <option value="cactus">ğŸŒµ Cactus</option>
                                </optgroup>
                                <option value="custom">â• Agregar Nueva...</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>RegiÃ³n del Ecuador:</label>
                            <select id="regionSelect">
                                <option value="costa">ğŸ–ï¸ Costa (0-1000m)</option>
                                <option value="sierra">â›°ï¸ Sierra (1000-3500m)</option>
                                <option value="oriente">ğŸŒ¿ Oriente AmazÃ³nico</option>
                            </select>
                        </div>
                        <div id="customPlantInput" style="display: none;">
                            <div class="input-group">
                                <label>Nombre de la planta:</label>
                                <input type="text" id="customPlantName" placeholder="Ej: Albahaca morada">
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn" onclick="selectPlantEcuador()">ğŸŒ± Aplicar Planta</button>
                            <button class="btn btn-info" onclick="showPlantGlossary()">ğŸ“– Ver Glosario Completo</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <h4>ParÃ¡metros Personalizados (Opcional)</h4>
                        <div class="input-group">
                            <label>Humedad del Suelo Ã“ptima (%):</label>
                            <input type="number" id="soilOptimal" min="0" max="100" value="50">
                        </div>
                        <div class="input-group">
                            <label>Humedad MÃ­nima (%):</label>
                            <input type="number" id="soilMin" min="0" max="100" value="25">
                        </div>
                        <div class="input-group">
                            <label>Humedad MÃ¡xima (%):</label>
                            <input type="number" id="soilMax" min="0" max="100" value="75">
                        </div>
                        <div class="input-group">
                            <label>Temperatura Ã“ptima (Â°C):</label>
                            <input type="number" id="tempOptimal" min="0" max="50" value="25">
                        </div>
                        <div class="input-group">
                            <label>Humedad del Aire Ã“ptima (%):</label>
                            <input type="number" id="humidOptimal" min="0" max="100" value="60">
                        </div>
                        <button class="btn" onclick="updateParameters()">âš™ï¸ Actualizar ParÃ¡metros</button>
                    </div>
                </div>
                
                <!-- InformaciÃ³n de la planta seleccionada -->
                <div id="plantInfoDisplay" class="mt-2">
                    <div class="plant-info-card">
                        <h4>â„¹ï¸ InformaciÃ³n de la Planta</h4>
                        <p>Selecciona una planta y regiÃ³n para ver informaciÃ³n detallada sobre sus requerimientos especÃ­ficos para Ecuador.</p>
                    </div>
                </div>

                <!-- ParÃ¡metros actuales -->
                <div id="currentParameters">
                    <strong>ParÃ¡metros Actuales:</strong><br>
                    Humedad Suelo: 25% - 75%<br>
                    Temperatura Ã“ptima: 25Â°C<br>
                    Humedad Aire Ã“ptima: 60%
                </div>
            </div>

            <!-- Control de Bomba -->
            <div class="section">
                <div class="pump-control">
                    <h3>ğŸ’§ Control de Bomba de Riego</h3>
                    <div class="pump-status" id="pumpStatusDisplay">
                        Estado: <span id="pumpState">Desactivada</span>
                    </div>
                    <button class="btn pump-btn" id="pumpBtn" onclick="togglePump()">
                        ğŸ”´ Activar Bomba
                    </button>
                    <div class="mt-2">
                        <button class="btn btn-info" onclick="autoMode()">ğŸ¤– Modo AutomÃ¡tico</button>
                        <button class="btn btn-warning" onclick="manualMode()">ğŸ‘¤ Modo Manual</button>
                        <button class="btn btn-danger" id="emergencyBtn" onclick="emergencyStop()">ğŸš¨ Parada de Emergencia</button>
                    </div>
                    <div id="autoModeStatus" class="mt-2">
                        Modo: Manual
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- ========================================= -->
    <!-- PÃGINA 2: GRÃFICAS Y DATOS -->
    <!-- ========================================= -->
    <div id="page-charts" class="page-content">
        <div class="container">
            
            <!-- GrÃ¡ficas -->
            <div class="section">
                <h3>ğŸ“Š GrÃ¡ficas en Tiempo Real</h3>
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">Sensores en Tiempo Real</div>
                        <canvas id="sensorsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Estados de Alerta</div>
                        <canvas id="alertsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Historial de Gas (Configurable)</div>
                        <canvas id="gasChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Nivel Ultrasonido (Configurable)</div>
                        <canvas id="ultraChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">Historial de Riego</div>
                        <canvas id="irrigationChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- EstadÃ­sticas -->
            <div class="section">
                <h3>ğŸ“ˆ EstadÃ­sticas del Sistema</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalReadings">0</div>
                        <div class="stat-label">Lecturas Totales</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="alertCount">0</div>
                        <div class="stat-label">Alertas Generadas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="irrigationCount">0</div>
                        <div class="stat-label">Riegos Realizados</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="uptime">0h</div>
                        <div class="stat-label">Tiempo Activo</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gasGoodCount">0</div>
                        <div class="stat-label">Lecturas Buenas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gasRegularCount">0</div>
                        <div class="stat-label">Lecturas Regulares</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gasBadCount">0</div>
                        <div class="stat-label">Lecturas Malas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gasDangerCount">0</div>
                        <div class="stat-label">Lecturas Peligrosas</div>
                    </div>
                </div>
            </div>

            <!-- Botones de Control de Datos -->
            <div class="section">
                <h3>âš™ï¸ GestiÃ³n de Datos</h3>
                
                <div class="data-controls">
                    <button class="btn" id="resetBtn" onclick="resetSensors()">
                        ğŸ”„ Resetear Sensores
                    </button>
                    <button class="btn btn-warning" id="clearBtn" onclick="clearData()">
                        ğŸ—‘ï¸ Limpiar Datos
                    </button>
                    <button class="btn btn-info" id="exportBtn" onclick="exportData()">
                        ğŸ“Š Exportar Datos
                    </button>
                </div>
                
                <div class="export-section">
                    <h4>ğŸ“‚ Importar / Exportar Datos</h4>
                    <p style="margin-bottom: 15px; color: var(--text-secondary);">
                        Exporta los datos del sistema en formato JSON para guardar un respaldo, 
                        o importa datos previamente guardados para restaurar el sistema.
                    </p>
                    <label for="importFile" class="btn btn-success" style="cursor: pointer;">
                        ğŸ“‚ Importar Datos JSON
                    </label>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
            </div>

        </div>
    </div>

    <!-- ========================================= -->
    <!-- PÃGINA 3: CONEXIÃ“N ARDUINO -->
    <!-- ========================================= -->
    <div id="page-arduino" class="page-content">
        <div class="container">
            
            <!-- SecciÃ³n de ConexiÃ³n Arduino -->
            <div class="section">
                <h3>ğŸ”Œ Conexiones Arduino</h3>
                <div class="connection-grid">
                    <!-- Arduino de Sensores -->
                    <div class="arduino-card" id="sensorsArduino">
                        <div class="arduino-title">
                            ğŸŒ¡ï¸ Arduino Sensores
                            <span class="connection-status" id="sensorsStatus">âšª</span>
                        </div>
                        
                        <div class="input-group">
                            <label>Baud Rate:</label>
                            <select id="sensorsBaud">
                                <option value="9600" selected>9600</option>
                                <option value="115200">115200</option>
                            </select>
                        </div>
                        
                        <button class="btn" id="connectSensors" onclick="connectSensorsArduino()">
                            Conectar Sensores
                        </button>
                        <button class="btn btn-danger" id="disconnectSensors" onclick="disconnectSensorsArduino()" disabled>
                            Desconectar
                        </button>
                        
                        <div class="connection-log" id="sensorsLog">Esperando conexiÃ³n...</div>
                        <div class="data-display" id="sensorsData">Sin datos de sensores</div>
                        
                        <div class="baudrate-info">
                            ğŸ’¡ <strong>Nota:</strong> AsegÃºrate de que el baudrate coincida con el configurado en tu cÃ³digo Arduino.
                        </div>
                    </div>

                    <!-- Arduino de Bomba -->
                    <div class="arduino-card" id="pumpArduino">
                        <div class="arduino-title">
                            ğŸ’§ Arduino Bomba
                            <span class="connection-status" id="pumpStatus">âšª</span>
                        </div>
                        
                        <div class="input-group">
                            <label>Baud Rate:</label>
                            <select id="pumpBaud">
                                <option value="9600" selected>9600</option>
                                <option value="115200">115200</option>
                            </select>
                        </div>
                        
                        <button class="btn" id="connectPump" onclick="connectPumpArduino()">
                            Conectar Bomba
                        </button>
                        <button class="btn btn-danger" id="disconnectPump" onclick="disconnectPumpArduino()" disabled>
                            Desconectar
                        </button>
                        
                        <div class="connection-log" id="pumpLog">Esperando conexiÃ³n...</div>
                        <div class="data-display" id="pumpData">Sin datos de bomba</div>
                        
                        <div class="baudrate-info">
                            ğŸ’¡ <strong>Nota:</strong> La bomba se apagarÃ¡ automÃ¡ticamente por seguridad al conectar.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controles RÃ¡pidos -->
            <div class="section">
                <h3>âš¡ Controles RÃ¡pidos</h3>
                <div class="quick-controls">
                    <button class="btn btn-success" onclick="connectAllArduinos()">
                        ğŸ”— Conectar Ambos Arduinos
                    </button>
                    <button class="btn btn-warning" onclick="disconnectAllArduinos()">
                        âŒ Desconectar Todo
                    </button>
                    <button class="btn btn-info" onclick="testConnections()">
                        ğŸ§ª Probar Conexiones
                    </button>
                </div>
            </div>

            <!-- Indicadores de Estado -->
            <div class="section">
                <h3>ğŸ“Š Estado de Conexiones</h3>
                <div style="text-align: center; margin-top: 20px;">
                    <div class="status-indicator disconnected" id="sensorStatusIndicator">
                        <span class="status-dot"></span>
                        <span>Arduino Sensores: Desconectado</span>
                    </div>
                    <div class="status-indicator disconnected" id="pumpStatusIndicator">
                        <span class="status-dot"></span>
                        <span>Arduino Bomba: Desconectado</span>
                    </div>
                </div>
            </div>

            <!-- InformaciÃ³n de Ayuda -->
            <div class="test-section">
                <h4>ğŸ” GuÃ­a de ConexiÃ³n</h4>
                <div style="text-align: left; max-width: 800px; margin: 0 auto;">
                    <p style="margin-bottom: 15px;">
                        <strong>1. Arduino de Sensores:</strong> Este Arduino lee los datos de los sensores (gas, ultrasonido, humedad del suelo, temperatura y humedad del aire) y los envÃ­a en formato JSON.
                    </p>
                    <p style="margin-bottom: 15px;">
                        <strong>2. Arduino de Bomba:</strong> Este Arduino controla la bomba de riego. Puede operarse en modo manual o automÃ¡tico segÃºn la humedad del suelo.
                    </p>
                    <p style="margin-bottom: 15px;">
                        <strong>3. Requisitos:</strong>
                        <ul style="margin-left: 30px; margin-top: 10px;">
                            <li>Navegador compatible: Chrome, Edge o Brave</li>
                            <li>ConexiÃ³n HTTPS (requerido para Web Serial API)</li>
                            <li>Drivers USB instalados para Arduino</li>
                        </ul>
                    </p>
                    <p style="margin-bottom: 15px;">
                        <strong>4. SoluciÃ³n de Problemas:</strong>
                        <ul style="margin-left: 30px; margin-top: 10px;">
                            <li>Si no aparece el puerto, verifica que el Arduino estÃ© conectado</li>
                            <li>Si hay error de conexiÃ³n, cierra otros programas que usen el puerto serie (como Arduino IDE)</li>
                            <li>Verifica que el baudrate coincida con tu cÃ³digo Arduino</li>
                        </ul>
                    </p>
                </div>
            </div>

        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/global.js"></script>
    <script src="js/plants.js"></script>
    <script src="js/monitoring.js"></script>
    <script src="js/arduino.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/navigation.js"></script>
</body>
</html>